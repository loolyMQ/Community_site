# Исправление проблемы с контактами руководителя

## Проблема
В админ панели при редактировании контактов руководителя происходило неправильное объединение данных:
- Старые контакты оставались в базе данных
- Новые контакты добавлялись к старым через запятую
- В результате получалась строка вида: "старый_контакт, новый_контакт"

## Причина
1. **Несоответствие типов данных**: В базе данных контакты руководителя хранятся как массивы (telegram[], vk[], phone[], website[], other[]), но поле email - это строка (String)
2. **Неправильная очистка**: При обновлении контактов старые данные не очищались полностью
3. **Ошибка в обработке email**: Код пытался установить email как массив, хотя в схеме это строка

## Исправления

### 1. Серверная часть (`server/src/controllers/CommunityController.ts`)

#### Исправлена функция `saveAllContacts`:
- Добавлена фильтрация пустых значений и значений "undefined"/"null"
- Email теперь сохраняется только один (первый из списка)
- Улучшена обработка различных типов контактов

#### Исправлен метод `updateCommunity`:
- **Всегда очищаются все поля контактов** перед установкой новых значений
- **Email обрабатывается как строка**, а не массив
- **Email теперь правильно обновляется** - если в новых контактах есть email, он устанавливается; если нет - очищается
- **Добавлена обработка пустых контактов** - при пустом вводе все контакты очищаются

### 2. Клиентская часть (`src/components/EditCommunityModal.tsx`)
- **Возвращен интерфейс к одной ячейке** для контактов руководителя (как было изначально)
- Добавлено предупреждение пользователю о том, что старые контакты будут полностью заменены
- Улучшена логика обработки данных

### 3. Хук `useCommunities` (`src/hooks/useCommunities.ts`)
- Исправлена обработка email руководителя (теперь обрабатывается как строка)
- Добавлена фильтрация дубликатов и пустых значений
- Улучшено логирование для отладки

## Результат
✅ **Проблема полностью решена**: Теперь при редактировании контактов руководителя:
- **Интерфейс остался в одной ячейке** (как было изначально)
- Старые контакты полностью очищаются при обновлении
- Новые контакты устанавливаются корректно
- **Email теперь правильно обновляется** - заменяется на новый или очищается
- Нет дублирования или неправильного объединения данных
- **Пользователь может безопасно удалять и заменять любые контакты**

## Тестирование
Создан и выполнен тест, который подтверждает:
- Корректное обновление контактов
- Правильную очистку контактов
- Отсутствие ошибок в базе данных

## Рекомендации
1. При дальнейшей разработке учитывать различие типов данных между полями
2. Добавить валидацию на клиентской стороне для предотвращения некорректных данных
3. Рассмотреть возможность унификации типов данных для контактов
